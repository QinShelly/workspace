//([PRODUCT].[UPC].[UPC].Members,[Measures].[Swell Volume Cases]) = [Measures].[Swell Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Other Adjustment Volume Cases]) = [Measures].[Other Adjustment Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Total Adjustment Volume Cases]) = [Measures].[Total Adjustment Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Store BRI Volume Cases]) = [Measures].[Store BRI Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Store On Hand Volume Cases]) = [Measures].[Store On Hand Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Store Shelf Capacity Volume Cases]) = [Measures].[Store Shelf Capacity Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Store Secondary Shelf Capacity Volume Cases]) = [Measures].[Store Secondary Shelf Capacity Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Store Shelf On Hand Volume Cases]) = [Measures].[Store Shelf On Hand Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Store Mezzanine On Hand Volume Cases]) = [Measures].[Store Mezzanine On Hand Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Regular Sales Volume Cases]) = [Measures].[Regular Sales Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Promoted Sales Volume Cases]) = [Measures].[Promoted Sales Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Total Sales Volume Cases]) = [Measures].[Total Sales Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
([PRODUCT].[UPC].[UPC].Members,[Measures].[Stock Out Volume Cases]) = [Measures].[Stock Out Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Store Ordered Volume Cases]) = [Measures].[Store Ordered Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");

//([PRODUCT].[UPC].[UPC].Members, [Measures].[DC Receipt Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[DC Receipt Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[DC Receipt Volume Cases]);

//([PRODUCT].[UPC].[UPC].Members, [Measures].[DC Forceout Shipment Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[DC Forceout Shipment Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[DC Forceout Shipment Volume Cases]);

//([PRODUCT].[UPC].[UPC].Members, [Measures].[DC Forceout Ordered Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[DC Forceout Ordered Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[DC Forceout Ordered Volume Cases]);

//([PRODUCT].[UPC].[UPC].Members, [Measures].[DC Shipment Warehouse Generated Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[DC Shipment Warehouse Generated Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[DC Shipment Warehouse Generated Volume Cases]);

//([PRODUCT].[UPC].[UPC].Members, [Measures].[DC Shipment Regular Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[DC Shipment Regular Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[DC Shipment Regular Volume Cases]);

//([PRODUCT].[UPC].[UPC].Members, [Measures].[DC Regular Ordered Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[DC Regular Ordered Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[DC Regular Ordered Volume Cases]);

//([PRODUCT].[UPC].[UPC].Members, [Measures].[Store Promoted Ordered Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[Store Promoted Ordered Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[Store Promoted Ordered Cases]);

//([PRODUCT].[UPC].[UPC].Members, [Measures].[Store Regular Ordered Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[Store Regular Ordered Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[Store Regular Ordered Volume Cases]);

//([PRODUCT].[UPC].[UPC].Members, [Measures].[Store Received Promoted Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[Store Received Promoted Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[Store Received Promoted Volume Cases]);
    
//([PRODUCT].[UPC].[UPC].Members, [Measures].[Store Forceout Receipts Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[Store Forceout Receipts Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[Store Forceout Receipts Volume Cases]);
    
//([PRODUCT].[UPC].[UPC].Members, [Measures].[Store Ordered Promoted Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[Store Ordered Promoted Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[Store Ordered Promoted Volume Cases]);

//([PRODUCT].[UPC].[UPC].Members, [Measures].[Store Ordered Turn Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[Store Ordered Turn Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[Store Ordered Turn Volume Cases]);

//([PRODUCT].[UPC].[UPC].Members, [Measures].[DC Forceout Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[DC Forceout Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[DC Forceout Volume Cases]);   
    
//([PRODUCT].[UPC].[UPC].Members, [Measures].[Store Received Turn Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[Store Received Turn Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[Store Received Turn Volume Cases]);
    
//([PRODUCT].[UPC].[UPC].Members, [Measures].[Store Forceout Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[Store Forceout Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[Store Forceout Volume Cases]);
    
//([PRODUCT].[UPC].[UPC].Members, [Measures].[Store Receipts Warehouse Generated Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[Store Receipts Warehouse Generated Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[Store Receipts Warehouse Generated Volume Cases]);
    
//([PRODUCT].[UPC].[UPC].Members, [Measures].[Store Receipts Regular Order Volume Cases])
// = IIF([PRODUCT].[UPC].Properties("CASE CONVERSION") = "1"
//    , [Measures].[Store Receipts Regular Order Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY")
//    , [Measures].[Store Receipts Regular Order Volume Cases]);
    
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Swell Volume Equivalent Units]) = [Measures].[Swell Volume Units] * [PRODUCT].[UPC].CURRENTMEMBER.Properties("EQUIVALENT UNIT");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[Store Forceout Reciepts Volume Equivalent Units]) = [Measures].[Store Forceout Receipts Volume Units] * [PRODUCT].[UPC].CURRENTMEMBER.Properties("EQUIVALENT UNIT");

CREATE  MEMBER CURRENTCUBE.[Measures].[Swell Percent of Sales Amount]
AS IIF([Measures].[Total Sales Amount]=0, null, [Measures].[Swell Amount]/[Measures].[Total Sales Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Other Adjustment Percent of Sales Amount]
AS IIF([Measures].[Total Sales Amount]=0, null, [Measures].[Other Adjustment Amount]/[Measures].[Total Sales Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Other Adjustment Percent of Cost Amount]
AS IIF([Measures].[Total Cost Amount]=0, null, [Measures].[Other Adjustment Amount]/[Measures].[Total Cost Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Swell Percent of Sales Volume]
AS IIF([Measures].[Total Sales Volume Units]=0, null, [Measures].[Swell Volume Units]/[Measures].[Total Sales Volume Units]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Other Adjustment Percent of Sales Volume]
AS IIF([Measures].[Total Sales Volume Units]=0, null, [Measures].[Other Adjustment Volume Units]/[Measures].[Total Sales Volume Units]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE MEMBER CURRENTCUBE.[Measures].[Swell Ind]
AS IIF([Measures].[Swell Volume Units] > 0,1,NULL), VISIBLE=0;

([STORE].[STORE].[STORE].Members,[Measures].[Swell Store Count]) = [Measures].[Swell Ind];

CREATE MEMBER CURRENTCUBE.[Measures].[Other Adjustment Ind]
AS IIF([Measures].[Other Adjustment Volume Units] > 0,1,NULL), VISIBLE=0;

([STORE].[STORE].[STORE].Members,[Measures].[Other Adjustment Store Count]) = [Measures].[Other Adjustment Ind];

CREATE MEMBER CURRENTCUBE.[Measures].[Total Adjustment Ind]
AS IIF([Measures].[Total Adjustment Volume Units] > 0,1,NULL), VISIBLE=0;

([STORE].[STORE].[STORE].Members,[Measures].[Total Adjustment Store Count]) = [Measures].[Total Adjustment Ind];

CREATE  MEMBER CURRENTCUBE.[Measures].[Total Adjustment Amount]
AS [Measures].[Reclaim Amount] + [Measures].[Swell Amount] + [Measures].[Other Adjustment Amount],
FORMAT_STRING = "$#,##0.00", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Total Adjustment Volume Units]
AS [Measures].[Reclaim Volume Units] + [Measures].[Swell Volume Units] + [Measures].[Other Adjustment Volume Units],
FORMAT_STRING = "#,###", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Total Adjustment Percent of Sales Amount]
AS IIF([Measures].[Total Sales Amount]=0, null, [Measures].[Total Adjustment Amount]/[Measures].[Total Sales Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Total Adjustment Percent of Cost Amount]
AS IIF([Measures].[Total Cost Amount]=0, null, [Measures].[Total Adjustment Amount]/[Measures].[Total Cost Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Total Adjustment Percent of Sales Volume]
AS IIF([Measures].[Total Sales Volume Units]=0, null, [Measures].[Total Adjustment Volume Units]/[Measures].[Total Sales Volume Units]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[DC Shipment Amount per Week]
AS [Measures].[DC Shipment Amount] / [Measures].[Plan Week Count],
FORMAT_STRING = "$#,##0.00", DISPLAY_FOLDER='Supply\DC Flow',ASSOCIATED_MEASURE_GROUP = 'DC SHIPMENT';

CREATE  MEMBER CURRENTCUBE.[Measures].[DC Shipment Volume Units per Week]
AS [Measures].[DC Shipment Volume Units] / [Measures].[Plan Week Count],
FORMAT_STRING = "#,##0.00", DISPLAY_FOLDER='Supply\DC Flow',ASSOCIATED_MEASURE_GROUP = 'DC SHIPMENT';

[Measures].[Vendor Service Level Rate] = IIF([Measures].[DC Ordered Volume Units] = 0, null, 1 - [Measures].[Stock Out Volume Units]/[Measures].[DC Ordered Volume Units]);

[Measures].[Service Level Rate] = IIF([Measures].[DC Ordered Volume Units] = 0, null, [Measures].[DC Shipment Volume Units]/[Measures].[DC Ordered Volume Units]);

[Measures].[Store Ordered Volume Cases] = [Measures].[Store Ordered Promoted Volume Cases] + [Measures].[Store Ordered Turn Volume Cases];

//([PRODUCT].[UPC].[UPC].Members,[Measures].[DC Forceout Volume Equivalent Units]) = [Measures].[DC Forceout Volume Units] * [PRODUCT].[UPC].CURRENTMEMBER.Properties("EQUIVALENT UNIT");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[DC Ordered Volume Equivalent Units]) = [Measures].[DC Ordered Volume Units] * [PRODUCT].[UPC].CURRENTMEMBER.Properties("EQUIVALENT UNIT");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[DC Shipment Volume Equivalent Units]) = [Measures].[DC Shipment Volume Units] * [PRODUCT].[UPC].CURRENTMEMBER.Properties("EQUIVALENT UNIT");
//([PRODUCT].[UPC].[UPC].Members,[Measures].[DC Receipt Volume Equivalent Units]) = [Measures].[DC Receipt Volume Units] * [PRODUCT].[UPC].CURRENTMEMBER.Properties("EQUIVALENT UNIT");

CREATE  MEMBER CURRENTCUBE.[Measures].[Reclaim Percent of Store Receipts]
AS IIF ([Measures].[Store Receipts Amount] = 0, NULL, [Measures].[Reclaim Amount] / [Measures].[Store Receipts Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';


CREATE  MEMBER CURRENTCUBE.[Measures].[LY Reclaim Percent of Store Receipts]
AS IIF ([Measures].[LY Store Receipts Amount] = 0, NULL, [Measures].[LY Reclaim Amount] / [Measures].[LY Store Receipts Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments\TYLY',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';


CREATE  MEMBER CURRENTCUBE.[Measures].[Total Adjustment Percent of Store Receipts]
AS IIF ([Measures].[Store Receipts Amount] = 0, NULL, [Measures].[Total Adjustment Amount] / [Measures].[Store Receipts Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';


CREATE  MEMBER CURRENTCUBE.[Measures].[LY Total Adjustment Amount]
AS [Measures].[LY Reclaim Amount] + [Measures].[LY Swell Amount] + [Measures].[LY Other Adjustment Amount],
FORMAT_STRING = "$#,##0.00", DISPLAY_FOLDER='Inventory\Adjustments\TYLY',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';


CREATE  MEMBER CURRENTCUBE.[Measures].[Total Loss vs Swell Allowance]
AS IIF ([Measures].[Swell Allowance Amount] = 0, NULL, [Measures].[Swell Amount] / [Measures].[Swell Allowance Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES', VISIBLE=1;


CREATE  MEMBER CURRENTCUBE.[Measures].[LY Total Loss vs Swell Allowance]
AS IIF ([Measures].[LY Swell Allowance Amount] = 0, NULL, [Measures].[LY Swell Amount] / [Measures].[LY Swell Allowance Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments\TYLY',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[LY Total Adjustment Percent of Store Receipts]
AS IIF ([Measures].[LY Store Receipts Amount] = 0, NULL, [Measures].[LY Total Adjustment Amount] / [Measures].[LY Store Receipts Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments\TYLY',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE MEMBER CURRENTCUBE.[Measures].[Cost Retail Authorized Flag Item Count] 
AS ([UNIQUES TYPE].[Cost Retail Authorized Flag].&[1] ,[DISTINCT TYPE].[KEY TYPE].&[1],[Measures].[Plan StoreItem Countx]),
FORMAT_STRING = "#,##0.00", DISPLAY_FOLDER='Inventory\On Hand', ASSOCIATED_MEASURE_GROUP = 'PLAN FACT', VISIBLE=1;

CREATE MEMBER CURRENTCUBE.[Measures].[LY Cost Retail Authorized Flag Item Count] 
AS ([UNIQUES TYPE].[LY Cost Retail Authorized Flag].&[1] ,[DISTINCT TYPE].[KEY TYPE].&[1],[Measures].[Plan StoreItem Countx]),
FORMAT_STRING = "#,##0.00", DISPLAY_FOLDER='Inventory\On Hand', ASSOCIATED_MEASURE_GROUP = 'PLAN FACT', VISIBLE=0;

CREATE  MEMBER CURRENTCUBE.[Measures].[TYLY Authorized Item Count Change]
AS IIF ([Measures].[LY Cost Retail Authorized Flag Item Count] = 0, NULL, ABS([Measures].[Cost Retail Authorized Flag Item Count] - [Measures].[LY Cost Retail Authorized Flag Item Count]) / [Measures].[LY Cost Retail Authorized Flag Item Count]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\On Hand',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Retailer Store Turn Service Level]
AS IIF([Measures].[Store Ordered Turn Volume Cases] =  0, null,[Measures].[Store Received Turn Volume Cases]/[Measures].[Store Ordered Turn Volume Cases]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER = 'Supply\Store Flow', ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[LY Retailer Store Turn Service Level]
AS IIF([Measures].[LY Store Ordered Turn Volume Cases] =  0, null,[Measures].[LY Store Received Turn Volume Cases]/[Measures].[LY Store Ordered Turn Volume Cases]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER = 'Supply\Store Flow\TYLY', ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Retailer Store Promoted Service Level]
AS IIF([Measures].[Store Ordered Promoted Volume Cases] =  0, null,[Measures].[Store Received Promoted Volume Cases]/[Measures].[Store Ordered Promoted Volume Cases]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER = 'Supply\Store Flow', ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[LY Retailer Store Promoted Service Level]
AS IIF([Measures].[LY Store Ordered Promoted Volume Cases] =  0, null,[Measures].[LY Store Received Promoted Volume Cases]/[Measures].[LY Store Ordered Promoted Volume Cases]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER = 'Supply\Store Flow\TYLY', ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Retailer Store Total Service Level]
AS IIF([Measures].[Store Ordered Volume Cases] =  0, null,[Measures].[Store Receipts Volume Cases]/[Measures].[Store Ordered Volume Cases]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER = 'Supply\Store Flow', ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[LY Retailer Store Total Service Level]
AS IIF([Measures].[LY Store Ordered Volume Cases] =  0, null,[Measures].[LY Store Receipts Volume Cases]/[Measures].[LY Store Ordered Volume Cases]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER = 'Supply\Store Flow\TYLY', ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Swell Percent of Store Receipts Amount]
AS IIF([Measures].[Store Receipts Amount] =  0, null,[Measures].[Swell Amount]/[Measures].[Store Receipts Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER = 'Inventory\Adjustments', ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[LY Swell Percent of Store Receipts Amount]
AS IIF([Measures].[LY Store Receipts Amount] =  0, null,[Measures].[LY Swell Amount]/[Measures].[LY Store Receipts Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER = 'Inventory\Adjustments\TYLY', ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Other Adjustment Percent of Store Receipts Amount]
AS IIF([Measures].[Store Receipts Amount] =  0, null,[Measures].[Other Adjustment Amount]/[Measures].[Store Receipts Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER = 'Inventory\Adjustments', ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[LY Other Adjustment Percent of Store Receipts Amount]
AS IIF([Measures].[LY Store Receipts Amount] =  0, null,[Measures].[LY Other Adjustment Amount]/[Measures].[LY Store Receipts Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER = 'Inventory\Adjustments\TYLY', ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

//CREATE  MEMBER CURRENTCUBE.[Measures].[DC On Hand Volume Units without CNS]
//AS NULL,
//FORMAT_STRING = "#,##0.00", DISPLAY_FOLDER = 'Inventory\On Hand', ASSOCIATED_MEASURE_GROUP = 'STORE SALES', VISIBLE=0;

CREATE HIDDEN SET CURRENTCUBE.[NON CNS DC OWNER] AS 
IIF (ISERROR([DC].[DC OWNER].[CNS]),[DC].[DC].[DC].MEMBERS,
extract([DC].[DC].[DC].members * except([DC].[DC OWNER].[DC OWNER].MEMBERS, [DC].[DC OWNER].[CNS]), [DC].[DC]));

SCOPE([Measures].[Avg DC On Hand Volume Units without CNS], [NON CNS DC OWNER]);
this = [Measures].[Avg DC On Hand Volume Units];
END SCOPE;

([LY Range], [Measures].[LY Avg DC On Hand Volume Units without CNS]) = ([Calendar].[Date].CurrentMember.lag(1092), [Measures].[Avg DC On Hand Volume Units without CNS]);

([LY Range], [Measures].[LY Total Sales Volume Units WithOut CNS]) = ([Calendar].[Date].CurrentMember.lag(1092), [Measures].[Total Sales Volume Units WithOut CNS]);

CREATE  MEMBER CURRENTCUBE.[Measures].[Total Sales Volume per Day Units without CNS]
AS IIF([Measures].[Plan Day Count] = 0, null, ([DISTINCT TYPE].[KEY TYPE].&[1], [Measures].[Total Sales Volume Units WithOut CNS])/[Measures].[Plan Day Count]),
FORMAT_STRING = "#,##0.00", DISPLAY_FOLDER = 'Inventory\On Hand', ASSOCIATED_MEASURE_GROUP = 'STORE SALES', VISIBLE=0;

CREATE  MEMBER CURRENTCUBE.[Measures].[LY Total Sales Volume per Day Units without CNS]
AS IIF([Measures].[LY Plan Day Count] = 0, null, ([DISTINCT TYPE].[KEY TYPE].&[1], [Measures].[LY Total Sales Volume Units WithOut CNS])/[Measures].[LY Plan Day Count]),
FORMAT_STRING = "#,##0.00", DISPLAY_FOLDER = 'Inventory\On Hand', ASSOCIATED_MEASURE_GROUP = 'STORE SALES', VISIBLE=0;

[Measures].[Retailer DC Days of Supply Avg] = IIF([Measures].[Total Sales Volume per Day Units without CNS] =  0, null, [Measures].[Avg DC On Hand Volume Units without CNS] / [Measures].[Total Sales Volume per Day Units without CNS]);

[Measures].[LY Retailer DC Days of Supply Avg] = IIF([Measures].[LY Total Sales Volume per Day Units without CNS] =  0, null, [Measures].[LY Avg DC On Hand Volume Units without CNS] / [Measures].[LY Total Sales Volume per Day Units without CNS]);

[Measures].[Store Receipts Volume Cases] = [Measures].[Store Forceout Volume Cases] + [Measures].[Store Receipts Warehouse Generated Volume Cases] + [Measures].[Store Receipts Regular Order Volume Cases];

CREATE HIDDEN SET [All Valid Ahold Period] AS Exists ( [CALENDAR].[Ahold Ad].[Ahold Period], [Measures].[STORE SALES Count], "Store Sales" );   
CREATE SET [Last Complete Ahold Period] AS Tail ( Filter( [All Valid Ahold Period],[Measures].[Period Last Date]=[Measures].[Period Last Date Filter]), 1 ), DISPLAY_FOLDER = 'Calendar';



--([PRODUCT].[UPC].[UPC].Members,[Measures].[Min Presentation Volume Cases]) = [Measures].[Min Presentation Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");

--([PRODUCT].[UPC].[UPC].Members,[Measures].[Future NPI Store Shelf Capacity Volume Cases]) = [Measures].[Future NPI Store Shelf Capacity Volume Units] * 1.0 / [PRODUCT].[UPC].CURRENTMEMBER.Properties("VENDOR PACK QTY");

CREATE MEMBER CURRENTCUBE.[Measures].[Future NPI Start Date] AS 
IIF( [Measures].[NPI Start Date Internal] = 0, null, DateValue(
	Left(CSTR([Measures].[NPI Start Date Internal]), 4)
	+ "-" + Mid(CSTR([Measures].[NPI Start Date Internal]), 5, 2)
	+ "-" + Right(CSTR([Measures].[NPI Start Date Internal]), 2)
	) 
),
DISPLAY_FOLDER = 'New Product Introduction',  ASSOCIATED_MEASURE_GROUP = 'STORE SALES', FORMAT_STRING="Short Date";

CREATE HIDDEN SET CURRENTCUBE.[AD1] as extract([PD] * {[CALENDAR].[Ahold Day of Week].&[Day 1]}, [Calendar].[Date]);
CREATE HIDDEN SET CURRENTCUBE.[AD2] as extract([PD] * {[CALENDAR].[Ahold Day of Week].&[Day 2]}, [Calendar].[Date]);
CREATE HIDDEN SET CURRENTCUBE.[AD3] as extract([PD] * {[CALENDAR].[Ahold Day of Week].&[Day 3]}, [Calendar].[Date]);
CREATE HIDDEN SET CURRENTCUBE.[AD4] as extract([PD] * {[CALENDAR].[Ahold Day of Week].&[Day 4]}, [Calendar].[Date]);
CREATE HIDDEN SET CURRENTCUBE.[AD5] as extract([PD] * {[CALENDAR].[Ahold Day of Week].&[Day 5]}, [Calendar].[Date]);
CREATE HIDDEN SET CURRENTCUBE.[AD6] as extract([PD] * {[CALENDAR].[Ahold Day of Week].&[Day 6]}, [Calendar].[Date]);
CREATE HIDDEN SET CURRENTCUBE.[AD7] as extract([PD] * {[CALENDAR].[Ahold Day of Week].&[Day 7]}, [Calendar].[Date]);

([AD1], [Measures].[Store On Hand Volume Units Modeled-Day prior Ad Break Internal]) =  ([Calendar].[Date].CURRENTMEMBER.LAG(3),[Measures].[Store On Hand Volume Units Modeled]);

([AD2], [Measures].[Store On Hand Volume Units Modeled-Day prior Ad Break Internal]) =  ([Calendar].[Date].CURRENTMEMBER.LAG(6),[Measures].[Store On Hand Volume Units Modeled]);

([AD3], [Measures].[Store On Hand Volume Units Modeled-Day prior Ad Break Internal]) =  ([Calendar].[Date].CURRENTMEMBER.LAG(9),[Measures].[Store On Hand Volume Units Modeled]);

([AD4], [Measures].[Store On Hand Volume Units Modeled-Day prior Ad Break Internal]) =  ([Calendar].[Date].CURRENTMEMBER.LAG(12),[Measures].[Store On Hand Volume Units Modeled]);

([AD5], [Measures].[Store On Hand Volume Units Modeled-Day prior Ad Break Internal]) =  ([Calendar].[Date].CURRENTMEMBER.LAG(15),[Measures].[Store On Hand Volume Units Modeled]);

([AD6], [Measures].[Store On Hand Volume Units Modeled-Day prior Ad Break Internal]) =  ([Calendar].[Date].CURRENTMEMBER.LAG(18),[Measures].[Store On Hand Volume Units Modeled]);

([AD7], [Measures].[Store On Hand Volume Units Modeled-Day prior Ad Break Internal]) =  ([Calendar].[Date].CURRENTMEMBER.LAG(21),[Measures].[Store On Hand Volume Units Modeled]);

(EXCEPT([Calendar].[Date].[Date],[PD]), [Measures].[Total Sales Volume Units First 2 Ad Days LNE]) = NULL;
(EXCEPT([Calendar].[Date].[Date],[PD]), [Measures].[Total Sales Volume Units First 2 Ad Days SUM]) = NULL;
(EXCEPT([Calendar].[Date].[Date],[PD]), [Measures].[Store Forceout Volume Units 5 Days prior Ad Break LNE]) = NULL;
(EXCEPT([Calendar].[Date].[Date],[PD]), [Measures].[Store Forceout Volume Units 5 Days prior Ad Break SUM]) = NULL;
(EXCEPT([Calendar].[Date].[Date],[PD]), [Measures].[Store Receipt Volume Units 5 Days prior Ad Break LNE]) = NULL;
(EXCEPT([Calendar].[Date].[Date],[PD]), [Measures].[Store Receipt Volume Units 5 Days prior Ad Break SUM]) = NULL;

([AD1], [Measures].[Total Sales Volume Units First 2 Ad Days Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LEAD(3), [CALENDAR].[Date].currentmember},[Measures].[Total Sales Volume Units]);
([AD2], [Measures].[Total Sales Volume Units First 2 Ad Days Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(3), [CALENDAR].[Date].currentmember},[Measures].[Total Sales Volume Units]);
([AD3], [Measures].[Total Sales Volume Units First 2 Ad Days Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(6), [CALENDAR].[Date].currentmember.LAG(3)},[Measures].[Total Sales Volume Units]);
([AD4], [Measures].[Total Sales Volume Units First 2 Ad Days Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(9), [CALENDAR].[Date].currentmember.LAG(6)},[Measures].[Total Sales Volume Units]);
([AD5], [Measures].[Total Sales Volume Units First 2 Ad Days Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(12), [CALENDAR].[Date].currentmember.LAG(9)},[Measures].[Total Sales Volume Units]);
([AD6], [Measures].[Total Sales Volume Units First 2 Ad Days Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(15), [CALENDAR].[Date].currentmember.LAG(12)},[Measures].[Total Sales Volume Units]);
([AD7], [Measures].[Total Sales Volume Units First 2 Ad Days Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(18), [CALENDAR].[Date].currentmember.LAG(15)},[Measures].[Total Sales Volume Units]);
([PD], [Measures].[Total Sales Volume Units First 2 Ad Days LNE]) = IIF(NOT ISEMPTY(([CALENDAR].[Date].CURRENTMEMBER,[Measures].[Total Sales Volume Units First 2 Ad Days Sum])),([CALENDAR].[Date].CURRENTMEMBER,[Measures].[Total Sales Volume Units First 2 Ad Days Sum]),null);
[Measures].[Total Sales Volume Units-First 2 Ad Days] = sum({existing [CALENDAR].[Ahold Ad Calendar Name].[Ahold Ad Calendar Name].MEMBERS},[Measures].[Total Sales Volume Units First 2 Ad Days LNE]);

([AD1], [Measures].[Store Forceout Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(3), [CALENDAR].[Date].currentmember.LAG(6), [CALENDAR].[Date].currentmember.LAG(9), [CALENDAR].[Date].currentmember.LAG(12), [CALENDAR].[Date].currentmember.LAG(15)},[Measures].[Store Forceout Volume Units]);
([AD2], [Measures].[Store Forceout Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(6), [CALENDAR].[Date].currentmember.LAG(9), [CALENDAR].[Date].currentmember.LAG(12), [CALENDAR].[Date].currentmember.LAG(15), [CALENDAR].[Date].currentmember.LAG(18)},[Measures].[Store Forceout Volume Units]);
([AD3], [Measures].[Store Forceout Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(9), [CALENDAR].[Date].currentmember.LAG(12), [CALENDAR].[Date].currentmember.LAG(15), [CALENDAR].[Date].currentmember.LAG(18), [CALENDAR].[Date].currentmember.LAG(21)},[Measures].[Store Forceout Volume Units]);
([AD4], [Measures].[Store Forceout Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(12), [CALENDAR].[Date].currentmember.LAG(15), [CALENDAR].[Date].currentmember.LAG(18), [CALENDAR].[Date].currentmember.LAG(21), [CALENDAR].[Date].currentmember.LAG(24)},[Measures].[Store Forceout Volume Units]);
([AD5], [Measures].[Store Forceout Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(15), [CALENDAR].[Date].currentmember.LAG(18), [CALENDAR].[Date].currentmember.LAG(21), [CALENDAR].[Date].currentmember.LAG(24), [CALENDAR].[Date].currentmember.LAG(27)},[Measures].[Store Forceout Volume Units]);
([AD6], [Measures].[Store Forceout Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(18), [CALENDAR].[Date].currentmember.LAG(21), [CALENDAR].[Date].currentmember.LAG(24), [CALENDAR].[Date].currentmember.LAG(27), [CALENDAR].[Date].currentmember.LAG(30)},[Measures].[Store Forceout Volume Units]);
([AD7], [Measures].[Store Forceout Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(21), [CALENDAR].[Date].currentmember.LAG(24), [CALENDAR].[Date].currentmember.LAG(27), [CALENDAR].[Date].currentmember.LAG(30), [CALENDAR].[Date].currentmember.LAG(33)},[Measures].[Store Forceout Volume Units]);
([PD], [Measures].[Store Forceout Volume Units 5 Days prior Ad Break LNE]) =  
IIF(NOT ISEMPTY(([CALENDAR].[Date].CURRENTMEMBER,[Measures].[Store Forceout Volume Units 5 Days prior Ad Break Sum]))
,([CALENDAR].[Date].CURRENTMEMBER,[Measures].[Store Forceout Volume Units 5 Days prior Ad Break Sum])
,null);
[Measures].[Store Forceout Volume Units-5 Days prior Ad Break] = sum({existing [CALENDAR].[Ahold Ad Calendar Name].[Ahold Ad Calendar Name].MEMBERS},[Measures].[Store Forceout Volume Units 5 Days prior Ad Break LNE]);

([AD1], [Measures].[Store Receipt Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(3), [CALENDAR].[Date].currentmember.LAG(6), [CALENDAR].[Date].currentmember.LAG(9), [CALENDAR].[Date].currentmember.LAG(12), [CALENDAR].[Date].currentmember.LAG(15)},[Measures].[Store Receipts Volume Units]);
([AD2], [Measures].[Store Receipt Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(6), [CALENDAR].[Date].currentmember.LAG(9), [CALENDAR].[Date].currentmember.LAG(12), [CALENDAR].[Date].currentmember.LAG(15), [CALENDAR].[Date].currentmember.LAG(18)},[Measures].[Store Receipts Volume Units]);
([AD3], [Measures].[Store Receipt Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(9), [CALENDAR].[Date].currentmember.LAG(12), [CALENDAR].[Date].currentmember.LAG(15), [CALENDAR].[Date].currentmember.LAG(18), [CALENDAR].[Date].currentmember.LAG(21)},[Measures].[Store Receipts Volume Units]);
([AD4], [Measures].[Store Receipt Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(12), [CALENDAR].[Date].currentmember.LAG(15), [CALENDAR].[Date].currentmember.LAG(18), [CALENDAR].[Date].currentmember.LAG(21), [CALENDAR].[Date].currentmember.LAG(24)},[Measures].[Store Receipts Volume Units]);
([AD5], [Measures].[Store Receipt Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(15), [CALENDAR].[Date].currentmember.LAG(18), [CALENDAR].[Date].currentmember.LAG(21), [CALENDAR].[Date].currentmember.LAG(24), [CALENDAR].[Date].currentmember.LAG(27)},[Measures].[Store Receipts Volume Units]);
([AD6], [Measures].[Store Receipt Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(18), [CALENDAR].[Date].currentmember.LAG(21), [CALENDAR].[Date].currentmember.LAG(24), [CALENDAR].[Date].currentmember.LAG(27), [CALENDAR].[Date].currentmember.LAG(30)},[Measures].[Store Receipts Volume Units]);
([AD7], [Measures].[Store Receipt Volume Units 5 Days prior Ad Break Sum]) =  AGGREGATE( { [CALENDAR].[Date].currentmember.LAG(21), [CALENDAR].[Date].currentmember.LAG(24), [CALENDAR].[Date].currentmember.LAG(27), [CALENDAR].[Date].currentmember.LAG(30), [CALENDAR].[Date].currentmember.LAG(33)},[Measures].[Store Receipts Volume Units]);
([PD], [Measures].[Store Receipt Volume Units 5 Days prior Ad Break LNE]) = 
IIF(NOT ISEMPTY(([CALENDAR].[Date].CURRENTMEMBER,[Measures].[Store Receipt Volume Units 5 Days prior Ad Break Sum]))
,([CALENDAR].[Date].CURRENTMEMBER,[Measures].[Store Receipt Volume Units 5 Days prior Ad Break Sum])
,null);
[Measures].[Store Receipt Volume Units-5 Days prior Ad Break] = sum({existing [CALENDAR].[Ahold Ad Calendar Name].[Ahold Ad Calendar Name].MEMBERS},[Measures].[Store Receipt Volume Units 5 Days prior Ad Break LNE]);

[Measures].[Store On Hand Volume Units Modeled-Day prior Ad Break] = sum({existing [CALENDAR].[Ahold Ad Calendar Name].[Ahold Ad Calendar Name].MEMBERS},[Measures].[Store On Hand Volume Units Modeled-Day prior Ad Break Internal]);

([PRODUCT].[UPC].[UPC].Members,[Measures].[Store On Hand Volume Cases Modeled-Day prior Ad Break]) = [Measures].[Store On Hand Volume Units Modeled-Day prior Ad Break] * 1.0/ [PRODUCT].[UPC].CURRENTMEMBER.Properties( "VENDOR PACK QTY");
([PRODUCT].[UPC].[UPC].Members,[Measures].[Total Sales Volume Cases-First 2 Ad Day]) = [Measures].[Total Sales Volume Units-First 2 Ad Days] * 1.0/ [PRODUCT].[UPC].CURRENTMEMBER.Properties( "VENDOR PACK QTY");
([PRODUCT].[UPC].[UPC].Members,[Measures].[Store Forceout Volume Cases-5 Days prior Ad Break]) = [Measures].[Store Forceout Volume Units-5 Days prior Ad Break] * 1.0/ [PRODUCT].[UPC].CURRENTMEMBER.Properties( "VENDOR PACK QTY");
([PRODUCT].[UPC].[UPC].Members,[Measures].[Store Receipt Volume Cases-5 Days prior Ad Break]) = [Measures].[Store Receipt Volume Units-5 Days prior Ad Break] * 1.0/ [PRODUCT].[UPC].CURRENTMEMBER.Properties( "VENDOR PACK QTY");


CREATE MEMBER CURRENTCUBE.[Measures].[Store On Hand Volume Units Modeled (Day prior Ad Break)]
 AS [Measures].[Store On Hand Volume Units Modeled-Day prior Ad Break],
DISPLAY_FOLDER = 'Use Cases',ASSOCIATED_MEASURE_GROUP = 'STORE SALES',FORMAT_STRING = "#,###",VISIBLE = 1;
 
CREATE MEMBER CURRENTCUBE.[Measures].[Store On Hand Volume Cases Modeled (Day prior Ad Break)]
 AS [Measures].[Store On Hand Volume Cases Modeled-Day prior Ad Break],
DISPLAY_FOLDER = 'Use Cases',ASSOCIATED_MEASURE_GROUP = 'STORE SALES',FORMAT_STRING = "#,##0.00",VISIBLE = 1;

CREATE MEMBER CURRENTCUBE.[Measures].[Total Sales Volume Units (First 2 Ad Days)]
 AS [Measures].[Total Sales Volume Units-First 2 Ad Days],
DISPLAY_FOLDER = 'Use Cases',ASSOCIATED_MEASURE_GROUP = 'STORE SALES',FORMAT_STRING = "#,###",VISIBLE = 1;
 
CREATE MEMBER CURRENTCUBE.[Measures].[Total Sales Volume Cases (First 2 Ad Days)]
 AS [Measures].[Total Sales Volume Cases-First 2 Ad Day],
DISPLAY_FOLDER = 'Use Cases',ASSOCIATED_MEASURE_GROUP = 'STORE SALES',FORMAT_STRING = "#,##0.00",VISIBLE = 1;

CREATE MEMBER CURRENTCUBE.[Measures].[Store Forceout Volume Units (5 Days prior Ad Break)]
 AS [Measures].[Store Forceout Volume Units-5 Days prior Ad Break],
DISPLAY_FOLDER = 'Use Cases',ASSOCIATED_MEASURE_GROUP = 'STORE SALES',FORMAT_STRING = "#,###",VISIBLE = 1;
 
CREATE MEMBER CURRENTCUBE.[Measures].[Store Forceout Volume Cases (5 Days prior Ad Break)]
 AS [Measures].[Store Forceout Volume Cases-5 Days prior Ad Break],
DISPLAY_FOLDER = 'Use Cases',ASSOCIATED_MEASURE_GROUP = 'STORE SALES',FORMAT_STRING = "#,##0.00",VISIBLE = 1;

CREATE MEMBER CURRENTCUBE.[Measures].[Store Receipt Volume Units (5 Days prior Ad Break)]
 AS [Measures].[Store Receipt Volume Units-5 Days prior Ad Break],
DISPLAY_FOLDER = 'Use Cases',ASSOCIATED_MEASURE_GROUP = 'STORE SALES',FORMAT_STRING = "#,###",VISIBLE = 1;
 
CREATE MEMBER CURRENTCUBE.[Measures].[Store Receipt Volume Cases (5 Days prior Ad Break)]
 AS [Measures].[Store Receipt Volume Cases-5 Days prior Ad Break],
DISPLAY_FOLDER = 'Use Cases',ASSOCIATED_MEASURE_GROUP = 'STORE SALES',FORMAT_STRING = "#,##0.00",VISIBLE = 1;

CREATE  MEMBER CURRENTCUBE.[Measures].[Store On Hand vs. Forecast Var Volume Units (First 2 Ad Days)]
AS [Measures].[Store On Hand Volume Units Modeled-Day prior Ad Break] - [Measures].[Retailer Store Forecast Volume Units-First 2 Ad Days],
FORMAT_STRING = "#,###", DISPLAY_FOLDER='Use Cases',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

CREATE  MEMBER CURRENTCUBE.[Measures].[Store On Hand vs. Forecast Var Volume Cases (First 2 Ad Days)]
AS  [Measures].[Store On Hand Volume Cases Modeled-Day prior Ad Break] - [Measures].[Retailer Store Forecast Volume Cases-First 2 Ad Days],
FORMAT_STRING = "#,##0.00", DISPLAY_FOLDER='Use Cases',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';

([LY Range], [Measures].[LY Avg DC on Hand Amount]) = ([Calendar].[Date].CurrentMember.lag(364), [Measures].[Avg DC on Hand Amount]);


CREATE MEMBER CURRENTCUBE.[Measures].[Retailer Store Out of Stock Indicator] 
AS ([DISTINCT TYPE].[KEY TYPE].&[2], [Measures].[Retailer Store Out Of Stock Indicator Internal]),
FORMAT_STRING = "#,###", VISIBLE = 1 , DISPLAY_FOLDER = 'Inventory\On Hand' ,  ASSOCIATED_MEASURE_GROUP = 'PLAN FACT';

[Measures].[Retailer Store Out Of Stock Rate] = 
IIF(([DISTINCT TYPE].[KEY TYPE].&[2], [Measures].[Retailer Store Out Of Stock Indicator Count]) =0, null
, (([DISTINCT TYPE].[KEY TYPE].&[2],[Measures].[Retailer Store Out Of Stock Indicator])/([DISTINCT TYPE].[KEY TYPE].&[2],[Measures].[Retailer Store Out Of Stock Indicator Count])));

[Measures].[Retailer Store In Stock Rate] = 
IIF(ISEMPTY([Measures].[Retailer Store Out Of Stock Rate]), null
, 1 - ([Measures].[Retailer Store Out Of Stock Rate]));

CREATE SET [Last Ahold Week Availability] as {Tail(nonempty([CALENDAR].[Ahold Ad].[Ahold Week Number],[Measures].[Weekly Availability % All Items]),1).Item(0)}, DISPLAY_FOLDER = 'Calendar';

CREATE HIDDEN SET [Last Ahold Week PER] AS 
{
	iif
	(
		sum
		(
			Tail(nonempty([CALENDAR].[Ahold Ad].[Ahold Week Number],[Measures].[STORE SALES Count]),1).Item(0).children,
			iif(([CALENDAR].[Ahold Ad].CurrentMember,[Measures].[STORE SALES Count])>0, 1, 0 )
		) <> Tail(nonempty([CALENDAR].[Ahold Ad].[Ahold Week Number],[Measures].[STORE SALES Count]),1).Item(0).children.count,
		Tail(nonempty([CALENDAR].[Ahold Ad].[Ahold Week Number],[Measures].[STORE SALES Count]),1).Item(0).Prevmember,
		Tail(nonempty([CALENDAR].[Ahold Ad].[Ahold Week Number],[Measures].[STORE SALES Count]),1).Item(0)
	)
}, DISPLAY_FOLDER = 'Calendar';

CREATE SET [Last Ahold Week] AS
{
	iif
	(
		sum
		(
			{[Last Ahold Week PER].item(0).item(0).Children * [CALENDAR].[Date].[Date]},
			iif(ISEMPTY(([CALENDAR].[Ahold Ad].CurrentMember, [CALENDAR].[Date].CurrentMember, [Measures].[STORE SALES Count])), 1, 0)
		) > 0,
		[Last Ahold Week PER].item(0).item(0).Prevmember,
		[Last Ahold Week PER].item(0).item(0)
	)
}, DISPLAY_FOLDER = 'Calendar';

--Include 'SpeedToShelf.mdx'

CREATE  MEMBER CURRENTCUBE.[Measures].[Swell Rate Percent]
AS IIF ([Measures].[Store Receipts Amount] = 0, NULL, [Measures].[Swell Allowance Amount] / [Measures].[Store Receipts Amount]),
FORMAT_STRING = "Percent", DISPLAY_FOLDER='Inventory\Adjustments',ASSOCIATED_MEASURE_GROUP = 'STORE SALES';